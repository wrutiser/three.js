<!doctype html>
<html lang="en">
<head>
    <title> HookEyes </title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <!--
    <link rel=stylesheet href="css/base.css"/>
-->
</head>
<body>

    Nothing to see here. Open the console.
<!-- ------------------------------------------------------------ -->
<!--
<script src="../build/Three.js"></script>
<script src="../examples/js/controls/OrbitControls.js"></script>
<script src="libs/DAT.GUI.min.js"></script>
<div id="ThreeJS" style="z-index: 0; position: absolute; left:0px; top:0px"></div>  
------------------------------------------------------------ -->
<script>
'use strict';

var objectID = function( ) { // open IIFE
  var objectIDglobal = 100;
  return function( prefix )
  {
    var z = objectIDglobal;
    objectIDglobal += 1;
    if( prefix === undefined )
    {
        prefix = ''
    }
    return prefix + z;
  }
}();  // close IIFE

//console.log( objectID('TST') );

function trueMod( i, n )
{
    return ( i % n + n ) % n
}

console.assert( trueMod( -3, 5 ) === 2, 'trueMod' );
console.assert( trueMod(  3, 5 ) === 3, 'trueMod' );


function Vertex( figure )
{
    this.id = objectID( 'V' )
    this.figure = figure;
    this.faces = new Array( figure.length );
    this.corners = new Array( figure.length );

    this.iNeg  = 0;
    this.iPos  = 0;
}
// slot i is assigned IFF iNeg <= i && iPos < i

Vertex.prototype.face = function( i )
{
    return this.faces[ trueMod( i, this.figure.length ) ];
}

Vertex.prototype.corner = function( i )
{
    return this.corners[ trueMod( i, this.figure.length ) ];
}

Vertex.prototype.sides = function( i )
{
    return this.figure[ trueMod( i, this.figure.length ) ];
}

Vertex.prototype.addCornerNeg = function( aFace, aCorner )
{
    this.iNeg = trueMod( this.iNeg - 1, this.figure.length );
    this.faces[ this.iNeg ] = aFace;
    this.corners[ this.iNeg ] = aCorner;
}

Vertex.prototype.addCornerPos = function( aFace, aCorner )
{
    this.faces[ this.iPos ] = aFace;
    this.corners[ this.iPos ] = aCorner;
    this.iPos = trueMod( this.iPos + 1, this.figure.length );
}

Vertex.prototype.show = function( label )
{
    console.log( '\n' + label, 'id: ' + this.id, '  iNeg: ' + this.iNeg, '  iPos: ' + this.iPos );
    var i;
    for( i = this.iNeg; i < this.iPos; i += 1 )
    {
      console.log( i, this.figure[i], this.faces[i].id, this.corners[i] );
    }
}
var testVertex = new Vertex( [3,2,3,2,3] );
  
//console.log( 'testVertex', testVertex );

testVertex.addCornerPos( 'foo', 'a' );
testVertex.addCornerNeg( 'foo', 'z' );
testVertex.addCornerPos( 'foo', 'b' );
testVertex.addCornerNeg( 'foo', 'y' );
testVertex.addCornerNeg( 'foo', 'x' );

// testVertex.show();
// console.log( 'testVertex', testVertex );

console.assert( testVertex.corner(-2) === testVertex.corner( 3 ) );

function Face( nSides )
{
  this.id = objectID( 'F' );
  this.vertices = Array( nSides );
  this.nSides = nSides;
}

var testFace = new Face( 3 );

Face.prototype.show = function( label )
{
    console.log( '\n' + label, 'id: ' + this.id, ' nSides: ' + this.nSides );
    var i;
    for( i = 0; i < this.nSides; i += 1 )
    {
      var v_i = this.vertices[ i ];
      if( v_i !== undefined ) {
          console.log( i + ': ', v_i.id );
      }
    }
}

Face.prototype.vertex = function( i )
{
    return this.vertices[ trueMod( i, this.nSides ) ];
}

//testFace.show( 'foo' );

function fooBuild( figure )
{

  // The initial face
    var iVslot = 0;
    var nSides = figure[ iVslot ] ;
    var f0 = new Face( nSides );
  // Going CCW around the face, add a new Vertex to each corner.
    var v_i;
    var i;
    for( i = 0; i < nSides ; i += 1 )
    {
        v_i = new Vertex( figure );
        v_i.addCornerPos( f0, i );
        f0.vertices[ i ] = v_i;
    }

///console.log( 'f0: ', f0 );

  // Begin at corner 0 of the initial face.
  // Add a second face to the vertex after(CCW) the initial face  
    var v_0 = f0.vertices[ 0 ];
    console.assert( v_0.iPos === 1 && v_0.iNeg === 0 );

    var nCorners  = v_0.figure[ v_0.iPos ];
    var f_i = new Face( nCorners );
  // Connect corner 0 of the face to the vertex
    v_0.addCornerPos( f_i, 0 );
    f_i.vertices[ 0 ] = v_0 ;
  // Connect the next corner of the second face to the previous corner of the first face. 
    var v_prev = f0.vertex( -1 );
    v_prev.addCornerPos( f_i, 2 ); //FIXME
    f_i.vertices[ 2 ] = v_prev ; //FIXME
  // Add a new Vertex to the remaining corners of the second face.
    f_i.vertices[ 1 ] = new Vertex( figure ); //FIXME 
    
    f0.show( 'f0' );
    f_i.show( 'f_i' );

    v_0.show( 'v_0' );
    v_prev.show( 'v_prev' );
    f_i.vertices[ 1 ].show( 'v_x' );

}  

fooBuild( [4, 3, 4, 3 ] );

/******************************************************
************************************/

//////////////////////////////////////////////////////
// OLD STUFF
/////////////////////////////////////////////////////

/*************************************************************************
function mkFace( nSides )
{
    var newFace = {
      corners: Array( nSides ),
      id: objectID( 'F' ),
    };
    var i;
    for( i = 0; i < nSides; i +=1 ){
        newFace.corners[ i ] = mkCorner( newFace );
    }

    return newFace;
}

function showFace( face )
{
  console.log( 'id: ', face.id );
  console.log( 'corners: ', face.corners, face.corners.length );
  console.log( 'corner 0:', face.corners[0] );
}

showFace( mkFace( 4 ) );
showFace( mkFace( 3 ) );

*************************************************************************/

/***************************************************************

function mkPerimeter( )
{
    var newPerimeter = {
      vs: [],   // vertices
      ix: 0,    // scanning index
    };
    return newPerimeter;
}


var thePerimeter = mkPerimeter();

function insertVertex( vertex, position )
{
    thePerimeter.vs.splice( position, 0, vertex );
}

function deleteVertex( position )
{
    thePerimeter.vs.splice( position, 1 );
}
function showPerimeter()
{
    var tp = thePerimeter;
    console.log( 'thePerimeter', 'length: ' + tp.vs.length, 'ix: ' + tp.ix  );
    var i;
    for( i = 0; i < tp.vs.length; i += 1 )
    {
      console.log( i, tp.vs[ i ] );
    }
}

showPerimeter();
insertVertex( mkVertex( 3 ), 0 );
insertVertex( mkVertex( 4 ), 0 );
insertVertex( mkVertex( 5 ), 0 );
showPerimeter();
deleteVertex( 1 );
showPerimeter();
insertVertex( mkVertex( 6 ), -1 );
showPerimeter();
deleteVertex( 2 );
showPerimeter();

function attachFace( vertexValence, thisFace, thisCorner, thatFace, thatCorner )  
{
    var thisV = thisFace.corners[ thisCorner ];
    var V = thatFace.corners[ thatCorner ];
    var theV;

    if( thisV === undefined ){
        if( thatV === undefined ) {
            theV = mkVertex( vertexValence );
            thisFace.corners[ thisCorner ] = theV;
            thatFace.corners[ thatCorner ] = theV;
        } else {
            thisFace.corners[ thisCorner ] = thatV;
            theV = thatV;
        }
    } else {
        if( thatV === undefined ) {
            thatFace.corners[ thatCorner ] = thisV;
            theV = thisV;
        } else {
            console.assert( thisV == thatV, 'thisV != thatV' );
            theV = thisV;
        }
    }    
    
//FIXME -- this is likely wrong



}

var sqF = mkFace( 4 );
console.log( 'sqF: ', sqF );
var triF = mkFace( 3 );
console.log( 'triF: ', triF );

attachFace( 4, sqF, triF, 0, 0 );

console.log( 'sqF: ', sqF );
console.log( 'triF: ', triF );

console.log( 'sqF.vertices', sqF.vertices );
console.log( 'triF.vertices', triF.vertices );




function attachFace( vertexValence, thisFace, thatFace, thisCorner, thatCorner )
{
// FIXME -- assume vertex is empty
    var vertex_a = mkVertex( vertexValence );
    showVertex( vertex_a );
    vertex_a.ngons[ 0 ] = thisFace;
    vertex_a.corners[ 0 ] = thisCorner;
    vertex_a.ngons[ 3 ] = thatFace;
    vertex_a.corners[ 3 ] = thatCorner;
    thisFace.vertices[0] = vertex_a;
    thatFace.vertices[0] = vertex_a;

    var vertex_b = mkVertex( vertexValence );
    vertex_b.ngons[ 1 ] = thisFace;
    vertex_b.corners[ 1 ] = thisCorner + 1;
    vertex_b.ngons[ 2 ] = thatFace;
    vertex_b.corners[ 2 ] = thatCorner - 1;
    thisFace.vertices[1] = vertex_b;
    thatFace.vertices[2] = vertex_b;
}
var sqF = mkFace( 4 );
console.log( 'sqF: ', sqF );
var triF = mkFace( 3 );
console.log( 'triF: ', triF );

attachFace( 4, sqF, triF, 0, 0 );

console.log( 'sqF: ', sqF );
console.log( 'triF: ', triF );

console.log( 'sqF.vertices', sqF.vertices );
console.log( 'triF.vertices', triF.vertices );

************************/

/**************************
function addFace( parentFace, parentSide, nEdges, v_0, v_1 )
{
  // create new face

  var newFace = {
    id: objectID(),
    parentFace: parentFace,
    nEdges: nEdges,
    neighbors: [ parentFace ],
    vertices: [ v_0, v_1 ],
  };

  parentFace.neighbors[ parentSide ] = newFace;

  return newFace;
}
var tstFace = {
  id: objectID(),
  nEdges:6,
  neighbors: [10,20,30,40,50,60 ],
  vertices: [ 200,201,202,203,204,205  ],
  };

console.log( addFace( tstFace, 3, 4, 204, 203) );
console.log( tstFace );

***********************************/

</script>
</body>
</html>
