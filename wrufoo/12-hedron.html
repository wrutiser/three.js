<!doctype html>
<html lang="en">
<head>
    <title> 12-Hedron </title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <!--
    <link rel=stylesheet href="css/base.css"/>
-->
</head>
<body>

<script src="../build/Three.js"></script>

<script src="../examples/js/controls/OrbitControls.js"></script>
<script src="libs/DAT.GUI.min.js"></script>

<!-- ------------------------------------------------------------ -->


<div id="ThreeJS" style="z-index: 0; position: absolute; left:0px; top:0px"></div>  

<script>
/*
This is based on template.html which is derived from:
	Three.js "tutorials by example"
	Author: Lee Stemkoski
	Date: July 2013 (three.js v59dev)

Unneed code has been removed. Restore as needed.
*/

// MAIN

// standard global variables
var container, scene, camera, renderer, controls, stats;
var RPD = Math.PI / 180;

// custom global variables
var mesh;

init();
animate();

// FUNCTIONS 		
function init() 
{
	// SCENE
	scene = new THREE.Scene();
	// CAMERA
	var SCREEN_WIDTH = window.innerWidth, SCREEN_HEIGHT = window.innerHeight;
	var VIEW_ANGLE = 45, ASPECT = SCREEN_WIDTH / SCREEN_HEIGHT, NEAR = 0.1, FAR = 20000;
	camera = new THREE.PerspectiveCamera( VIEW_ANGLE, ASPECT, NEAR, FAR);
	scene.add(camera);
	camera.position.set(0,150,400);
	camera.lookAt(scene.position);	
	// RENDERER
  renderer = new THREE.WebGLRenderer( {antialias:true} );
	renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);
	container = document.getElementById( 'ThreeJS' );
	container.appendChild( renderer.domElement );
	// EVENTS
	// CONTROLS
	controls = new THREE.OrbitControls( camera, renderer.domElement );
	// STATS
	// LIGHT
	var light1 = new THREE.PointLight(0xffffff);
	light1.position.set(100,250,100);
	scene.add(light1);
	var light2 = new THREE.PointLight(0xffffff);
	light2.position.set(.100,-250,100);
	scene.add(light2);
  var amblight = new THREE.AmbientLight( 0x444444 );
  scene.add(amblight);
  
  var color1 = new THREE.Color( 0x777777 ) ;
  var color2 = new THREE.Color( 0xeeeeee ) ;
  scene.add( makeFloor( color1, color2, 1, 1 ));
  scene.add( new THREE.AxisHelper(100) );

	// SKYBOX
	var skyBoxGeometry = new THREE.CubeGeometry( 10000, 10000, 10000 );
	var skyBoxMaterial = new THREE.MeshBasicMaterial( { color: 0x9999ff, side: THREE.BackSide } );
	var skyBox = new THREE.Mesh( skyBoxGeometry, skyBoxMaterial );
	scene.add(skyBox);
	
	////////////
	//  GUI   //
	////////////

  var gui = new dat.GUI();
  gui_parameters =
  {
    floorcolor1:  "#777777",
    floorcolor2:  "#eeeeee",
    floorpnumber1: 1,
    floorpnumber2: 1,
    floorvisible: true,
    recolorfloor: function(){ paintfloor(); },
    model: "Flag"                  
  }

  var floorFolder = gui.addFolder( 'Floor' );

  var floorColor1 = floorFolder.addColor( gui_parameters, 'floorcolor1' )
          .name( "Color 1" );
  var floorColor2 = floorFolder.addColor( gui_parameters, 'floorcolor2' ) 
          .name( "Color 2" );
  floorFolder.add( gui_parameters, 'recolorfloor' ).name( "Paint Floor" );

  var floorNumber1 = floorFolder.add( gui_parameters, 'floorpnumber1' )
          .name( "Number 1" );
  var floorNumber2 = floorFolder.add( gui_parameters, 'floorpnumber2' )
          .name( "Number 2" );
  var floorVisible = floorFolder.add( gui_parameters, 'floorvisible' )
          .name( "Visible?" );

  var modelselector = gui.add( gui_parameters, 'model',
                [ "None", "ButterFly", "WIP" ] )
          .onChange( function(value) { changeModel( value ) } );



  function paintfloor()
  {
    color1x = parseInt( gui_parameters.floorcolor1.replace("#","0x") );
    var color1 = new THREE.Color( color1x );
    color2x = parseInt( gui_parameters.floorcolor2.replace("#","0x") );
    var color2 = new THREE.Color( color2x );
    var newfloor = makeFloor( color1, color2,
          gui_parameters.floorpnumber1, gui_parameters.floorpnumber2 ) ;
    newfloor.visible = gui_parameters.floorvisible;
    scene.remove( scene.getObjectByName( "FlOoR", false ) );
    scene.add( newfloor );
  }

  function changeModel( value ) 
  {
    scene.remove( scene.getObjectByName( "HeDrOn", false ) );
    
    if( value == "None" ){
        mesh = new THREE.Mesh( );
    } else if( value == "WIP" ) {
        mesh = WIPModel( 50 );
    } else if( value == "ButterFly" ) {
        mesh = butterFlyModel( 30 );
    } else {
      mesh = new THREE.Mesh();
    }
    scene.add( mesh );
    mesh.name = "HeDrOn";

  }

	////////////
	// CUSTOM //
	////////////
	
  changeModel( "WIP" ); // FIXME -- temp for WIP
}

function animate() 
{
  requestAnimationFrame( animate );
	render();		
	update();
}

function update()
{
	/*****************
  if ( keyboard.pressed("z") ) 
	{	  
		// do something
	}
	************************/
//////////////////////	controls.update();
	camera.up = new THREE.Vector3(0,1,0);
	//////////////////stats.update();
}

function render() 
{
	renderer.render( scene, camera );
}

function polarVec( r, degrees )
{
  var radians = degrees * RPD;
  return new THREE.Vector3( r * Math.cos( radians ), r * Math.sin( radians ), 0 );
} 


function WIPModel( outRadius )
{
  var inRadius = outRadius * Math.sin( 54 * RPD ) ;
  var DHA = 2 * Math.asin( Math.cos(36 * RPD) / Math.sin( 72 * RPD ) ) / RPD;
  var EDGE = outRadius * 2 * Math.sin( 36 * RPD ) ;

  var geometry = new ngonGeometry( 5, outRadius );
  var redMaterial = new THREE.MeshLambertMaterial(
      { side: THREE.DoubleSide, shading: THREE.FlatShading, wireframe:false, color: "red"}
      );
  var blueMaterial = new THREE.MeshLambertMaterial(
      { side: THREE.DoubleSide, shading: THREE.FlatShading, wireframe:false, color: "blue"}
      );
  var greenMaterial = new THREE.MeshLambertMaterial(
      { side: THREE.DoubleSide, shading: THREE.FlatShading, wireframe:false, color: "green"}
      );
  var yellowMaterial = new THREE.MeshLambertMaterial(
      { side: THREE.DoubleSide, shading: THREE.FlatShading, wireframe:false, color: "yellow"}
      );
  var redMesh = new THREE.Mesh( geometry, redMaterial );
  var blueMesh = new THREE.Mesh( geometry, blueMaterial );
  var greenMesh = new THREE.Mesh( geometry, greenMaterial );
  var yellowMesh = new THREE.Mesh( geometry, yellowMaterial );

  var theta = (90 - DHA / 2) * RPD ; // approximately 31.7 degrees
  var phi = Math.acos( (Math.cos( 36 * RPD ) - 0.5) / Math.sin( 36 * RPD ) ); // approximately 58.3 degrees

  redMesh.rotation = new THREE.Euler( -theta, 0, -18 * RPD, 'XYZ' );
  redMesh.position = new THREE.Vector3( 0,
          inRadius * -Math.cos( theta ),
          inRadius * Math.sin( theta ) );

  blueMesh.rotation = new THREE.Euler(  theta, 0, +18 * RPD, 'XYZ' );
  blueMesh.position = new THREE.Vector3( 0,
          inRadius * Math.cos( theta ),
          inRadius * Math.sin( theta )) ;

  greenMesh.rotation = new THREE.Euler(  0, phi, 0, 'XYZ' );
  greenMesh.position = new THREE.Vector3( -outRadius * Math.cos( phi ) - EDGE / 2,
          0,
        outRadius * Math.sin( phi )) ;

  yellowMesh.rotation = new THREE.Euler(  0, -phi, 36 * RPD, 'XYZ' );
  yellowMesh.position = new THREE.Vector3( outRadius * Math.cos( phi ) + EDGE / 2,
          0,
        outRadius * Math.sin( phi )) ;

  var obj = new THREE.Object3D();
  obj.add( redMesh );
  obj.add( blueMesh );
  obj.add( greenMesh );
  obj.add( yellowMesh );

  /*********************** EXPERIMENT *********/

  obja = obj.clone() ;
  objb = obj.clone() ;

  obja.position = new THREE.Vector3( 0 * outRadius, 0, 3 * outRadius) ;
  obja.rotation = new THREE.Euler( 0, -180 * RPD, 0 , 'XYZ' );

  objb.position = new THREE.Vector3( 0, +1.5 * outRadius,1.5 * outRadius) ;
  objb.rotation = new THREE.Euler( 90 * RPD, 0 * RPD, 90 * RPD, 'XYZ' );


  objx = new THREE.Object3D();

  objx.add( obj );
  objx.add( obja );
  objx.add( objb );
  return objx;
  
  /*********************** END EXPERIMENT *********/
  return obj;
}

function butterFlyModel0( outRadius )
{
  inRadius = outRadius * Math.sin( 54 * Math.PI / 180 ) ;
  var y_axis = new THREE.Vector3(0,1,0);
  var z_axis = new THREE.Vector3(0,0,1);

  var obj0 = new THREE.Object3D();    
  var obj1 = new THREE.Object3D();    
  var obj2 = new THREE.Object3D();    
  var obj3 = new THREE.Object3D();    

  var geometry = new ngonGeometry( 5, outRadius );
  var material = new THREE.MeshLambertMaterial( { side: THREE.DoubleSide, shading: THREE.FlatShading, wireframe:false, color: 0x999900 } );
  var mesh = new THREE.Mesh( geometry, material );

  obj0.add( mesh );
  obj0.translateX( inRadius );
  
  obj1.add( obj0 );
  obj1.rotateOnAxis( y_axis, -148 * Math.PI / 180 );

  obj2.add( obj1.clone() );
  
  obj2.rotateOnAxis( z_axis, Math.PI );

  obj3.add( obj1 );
  obj3.add( obj2 );
  obj3.position.set(0,40,0);

  scene.add(obj3);
  return obj3;
}

function butterFlyModel( outRadius )
{
  var RPD  = Math.PI / 180;
  inRadius = outRadius * Math.sin( 54 * Math.PI / 180 ) ;
  dihedralAngle = 115 * RPD ;
  var y_axis = new THREE.Vector3(0,1,0);
  var z_axis = new THREE.Vector3(0,0,1);

  var geometry = new ngonGeometry( 5, outRadius );
  var material = new THREE.MeshNormalMaterial( { side: THREE.DoubleSide } );

  // Left side
  var mesh1 = new THREE.Mesh( geometry, material );
  mesh1.position.x = inRadius;
  mesh1.position.y = inRadius;  // raised
  var obj1 = new THREE.Object3D();    
  obj1.add( mesh1 );
  obj1.rotation.y = (3 * Math.PI - dihedralAngle) / 2; 
  
  // Right side`
  var mesh2 = new THREE.Mesh( geometry, material );
  mesh2.position.x = inRadius;
  mesh2.position.y = inRadius;  // raised
  mesh2.rotation.x = Math.PI;
  var obj2 = new THREE.Object3D();    
  obj2.add( mesh2 );
  obj2.rotation.y = -( Math.PI - dihedralAngle) / 2; 

  var obj3 = new THREE.Object3D();    
  obj3.add( obj1 );
  obj3.add( obj2 );
  
  scene.add( obj3 );
  return obj3;
}


function ngonGeometry( n, radius )
{
  var geometry = new THREE.Geometry();
  geometry.vertices = ngonVertices( n, radius );
  var normal = new THREE.Vector3( 0, 0, 1 );
  for( var i = 1; i < n; i += 1 )
  {
    geometry.faces.push( new THREE.Face3( 0, i, i + 1, normal ) );
  }
  geometry.faces.push( new THREE.Face3( 0, n, 1, normal ) );
  geometry.computeBoundingSphere();
  return geometry ;
}

function ngonVertices( n, radius )
{
  var delta_theta = (2 * Math.PI ) / n;
  var vertices = [];
  for( var i = 0; i <= n; i += 1 )
  {
    var theta = i * delta_theta;
    var x = Math.cos( theta ) * radius
    var y = Math.sin( theta ) * radius
    vertices.push( new THREE.Vector3( x, y, 0 ) );
  }
  return vertices ;
}

function ngonModel( n, radius )
{
    var geometry = new ngonGeometry( n, radius );
    var material = new THREE.MeshLambertMaterial( { shading: THREE.FlatShading, wireframe:false, color: 0x999900 } );
    var mesh = new THREE.Mesh( geometry, material );
    mesh.position.set(0,40,0);
    scene.add(mesh);
    return mesh;
}        


// Floor

function makeFloor( color1, color2, num1, num2 )
{
    var floorGeometry = new THREE.PlaneGeometry(1000, 1000, 10, 10);

    var i = 0;
    while( i + num1 + num2 <= floorGeometry.faces.length ){
      for( var j = 0; j < num1; j += 1 ){
        face  = floorGeometry.faces[ i ];	
        face.color.set(color1);		
        i += 1;
      }
      for( var j = 0; j < num2; j += 1 ){
        face  = floorGeometry.faces[ i ];	
        face.color.set(color2);		
        i += 1;
      }

    }

    var floorMaterial = new THREE.MeshBasicMaterial(
      { color: 0xffffff, vertexColors: THREE.FaceColors, side: THREE.DoubleSide } );
    var floor = new THREE.Mesh(floorGeometry, floorMaterial);
    floor.position.y = -0.5;
    floor.rotation.x = Math.PI / 2;
    floor.name = "FlOoR";

    return floor;
}

</script>

</body>
</html>
